
var config = require('hikerJoy').config;
var mongo = require('mongodb');
var server = new mongo.Server('localhost', 27017, { auto_reconnect: true });
var db = new mongo.Db(config.dbName, server, { safe: true });

var collections = {
    'users': null,
    'orgs': null,
    'userMsg': null,
    'pwdReset': null,
    'acts': null,
    'userActs': null,
    'emails': null,
    'actTags': null,
    'weixin': null,
    'sessions': null,
    'forumPost': null,
    'forumPostPrm': null,
    'forumPostSec': null,
    'cacheInfo': null
};

db.open(function (err, db) {
    if (err)
        console.log('failed to open db: ' + config.dbName + 'dataBase.js, err: ' + err);
    else {
        for (var i in collections) {
            (function (idx) {
                db.collection(config.dbCols[idx], { safe: true }, function (err, col) {
                    if (err || !col)
                        console.log('failed to get collection: ' + config.dbCols[idx] + ' for dataBase.js, err: ' + err);
                    else {
                        collections[idx] = col;
                    };
                });
            })(i);
        };
    };
});

exports.collections = collections;
